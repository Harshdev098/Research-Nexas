<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="css/profile.css">
    <style>
        .dualBtns {
            display: flex;
            justify-content: center;
        }

        .btn-save {
            background-color: #04AA6D;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 20px;
        }

        .btn-cancel {
            background-color: #F95454;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 20px;
        }

        /* Additional styling can go here */
    </style>

</head>

<body>
    <container class="container">
        <nav class="side-nav">
          <div class="logo">
            <img src="images/Research_Nexas_favicon_io/apple-touch-icon.png" width="60px" height="60px">
            <h2 class="heading">Unify</h2>
          </div>
          <br>
          <div class="profile-section">
            <div class="outer-profile">
                <span class="profile-icon">
                    <img src="" style="width:30px; height:30px; border-radius: 50px;"></img>
                </span>
                <h5 id="username">User</h5>
            </div>
            
            <notification>
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="grey" class="bi bi-bell-fill" viewBox="0 0 16 16" >
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2m.995-14.901a1 1 0 1 0-1.99 0A5 5 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901"/>
                  </svg>
                  
            </notification>
            <count class="count">5</count>
          </div>
          <br>
          <br>
          <p style="color:bisque">GENERAL</p>
          <br>
          <div class="box" onclick="toggleDarkMode()">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
                <path d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>
              </svg>
              <p class="text">Change Mode</p>
          </div>
          <br>
          <div class="box">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-person-lines-fill" viewBox="0 0 16 16">
                <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z"/>
              </svg>
              <p class="text">Profile</p>
          </div>
          <br>
          <div class="box">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-house" viewBox="0 0 16 16">
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
              </svg>
              <p class="text" onclick="navigate()"> Home</p>
          </div>
          <br>
          <div class="box">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-journals" viewBox="0 0 16 16">
                <path d="M5 0h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2 2 2 0 0 1-2 2H3a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1H1a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1H3a2 2 0 0 1 2-2"/>
                <path d="M1 6v-.5a.5.5 0 0 1 1 0V6h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V9h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 2.5v.5H.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1H2v-.5a.5.5 0 0 0-1 0"/>
              </svg>
              <p class="text" onclick="viewResult()"><i class=""></i>View Result</p>
          </div>
          <br>
          <br>
          <br>
          <div class="box" id="log">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
              </svg>
              <h3 style="color:darkgoldenrod" onclick="handleLogout()" >Log Out</h3>
          </div>
          <br>
          <br>
          <p style="color:bisque" onclick="openEditModal()">EDIT PROFILE</p>
        </nav>
        <main style="width:100%">
            
        <top class="main-top">
            <p>
                <div class="gtranslate_wrapper"></div>
                <script>
                    window.gtranslateSettings = {
                        default_language: "en",
                        detect_browser_language: true,
                        wrapper_selector: ".gtranslate_wrapper",
                        font_size: 100,
                    };
                </script>
                <script src="https://cdn.gtranslate.net/widgets/latest/popup.js" defer></script>
            </p>
            <div class="profile-pic">
                <img src="" style="width:50px; height:50px; border-radius: 50px;"></img>
            </div>
        </top>
        <h1  class="user-text">PROFILE</h1>
        <div style="display:flex;flex-direction:column;">
            <div class="profile-pic-add">
                <div>
                <div class="add-pic">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16" style="position:relative; left:4.6rem; top:5rem">
                        <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                        <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"/>
                      </svg>
                </div>
                <br>
                <p style="color:red">Allowed *JPEG, *JPG, *PNG</p>
            </div>
            </div>
            <div class="profile-details">
            <div id="profileContainer">
                <div id="detail">
                    <ul>
                        <li><span class="detail-text">Name:</span> <p id="name"></p></li>
                        <li><span class="detail-text">Email: </span><p id="email"></p></li>
                        <li><span class="detail-text">College Name:</span> <p id="col_name"></p></li>
                        <li><span class="detail-text">State: </span><p id="state"></p></li>
                        <li><span class="detail-text">Year:</span> <p id="year"></p></li>
                        <li><span class="detail-text">Course:</span> <p id="course"></p></li>
                    </ul>
                </div>
            </div>
            <div id="editProfileModal" style="display: none;">
                <div id="editForm">
                    <div id="detail">
                        <ul>
                            <li><div class="detail-text">Name: </div><input type="text" id="editName" required style="width:100%; font-size: 18px;"></input></li>
                            <li><div class="detail-text">Email: </div><input type="email" id="editEmail" required style="width:100%;font-size: 18px;"></input></li>
                            <li><div class="detail-text">College Name: </div><input type="text" id="editCollege" required style="width:100%;font-size: 18px;"></input></li>
                            <li><div class="detail-text">State: </div><input type="text" id="editState" required style="width:100%;font-size: 18px;"> </input></li>
                            <li><div class="detail-text">Year: </div><input type="number" id="editYear" required style="width:100%;font-size: 18px;"></input></li>
                            <li><div class="detail-text">Course: </div><input type="text" id="editCourse" required style="width:100%;font-size: 18px;"></input></li>
                        </ul>
                    </div>
                    <div class="dualBtns">
                        <button type="submit" class="btn-save" onclick="submit()">Save</button>
                        <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                    </div>
                </div>
            </div>
            </div>
            <div id="result">
                <strong>Result Status: <p id="status"></p><p id="marks"></p></strong>
                <div class="data">
                    <p>The rating given to your Research paper by the faculties is:</p>
                </div>
            </div>
        </div>
        </div>
        
        

        </main>
    </container>
    <script>
        const token = localStorage.getItem('accessToken');
        if (!token) {
            window.location.href = '/';
        }

        
        async function fetchdata() {
            const token = localStorage.getItem('accessToken');
            const response = await fetch('/dashboard', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                },
            });
            if (response.status == 200) {
                const data = await response.json();
                document.getElementById('username').textContent = data.username;
                document.getElementById('name').textContent = data.name;
                document.getElementById('email').textContent = data.email;
                document.getElementById('col_name').textContent = data.col_name;
                document.getElementById('state').textContent = data.state;
                document.getElementById('year').textContent = data.year;
                document.getElementById('course').textContent = data.course;
            }
        }
        fetchdata();

        const toggleDarkMode = () => {
    const bodyElement = document.querySelector('body');
    const navElement = document.querySelector('.side-nav');
    const mainElement=document.querySelector('main')
    const text=document.querySelector('.user-text')
    text.classList.toggle('dark-mode')
    mainElement.classList.toggle('dark-mode');
    bodyElement.classList.toggle('dark-mode');
    navElement.classList.toggle('dark-mode');
};

        const handleLogout = () => {
            localStorage.removeItem("accessToken");
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        };
        const navigate=()=>{
            setTimeout(() => {
                window.location.href = 'main_page.html';
            }, 2000);
        }


        const viewResult = async () => {
        console.log("hello")
            const token = localStorage.getItem('accessToken');
            const response = await fetch('/result', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                }
            });
            if (response.status == 201) {
                const data = await response.json();
                document.getElementById('status').textContent = data.status;
                document.getElementById('marks').textContent = data.percent;
            } else {
                document.getElementById('result').textContent = "Result not declared yet!";
                document.getElementById('result').style.color = "red";
                document.getElementById('result').style.padding = "16px";
            }
        };

        function openEditModal() {
            document.getElementById('profileContainer').style.display = 'none';
            document.getElementById('editProfileModal').style.display = 'block';
            document.getElementById('editName').value = document.getElementById('name').textContent;
            document.getElementById('editEmail').value = document.getElementById('email').textContent;
            document.getElementById('editCollege').value = document.getElementById('col_name').textContent;
            document.getElementById('editState').value = document.getElementById('state').textContent;
            document.getElementById('editYear').value = document.getElementById('year').textContent;
            document.getElementById('editCourse').value = document.getElementById('course').textContent;
        }

        function closeEditModal() {
            document.getElementById('editProfileModal').style.display = 'none';
            document.getElementById('profileContainer').style.display = 'block';
        }

        const submit = async () => {
    const updatedData = {
        name: document.getElementById('editName').value,
        email: document.getElementById('editEmail').value,
        col_name: document.getElementById('editCollege').value,
        state: document.getElementById('editState').value,
        year: document.getElementById('editYear').value,
        course: document.getElementById('editCourse').value
    };

    try {
        const response = await fetch('/updateProfile', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(updatedData)
        });

        if (response.ok) {
            
            const data = await response.json();

            console.log("Updated Profile Data:", data);

            
            alert("Profile Updated Successfully");

         
            window.location.reload();
        } else {
            alert("Failed to update profile");
        }
    } catch (error) {
        console.error('Error updating profile:', error);
    }
};


        
    </script>
</body>

</html>

