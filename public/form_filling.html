<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="css/form.css">
    <title>Form</title>
</head>

<body>
    <div style="position: absolute; bottom: 30px; left: 30px;" class="gtranslate_wrapper"></div>
    <script>
       window.gtranslateSettings = {
         default_language: "en",
         detect_browser_language: true,
         wrapper_selector: ".gtranslate_wrapper",
         font_size: 100,
       };
     </script>
     <script
     src="https://cdn.gtranslate.net/widgets/latest/popup.js"
     defer
   ></script>
    <ul class="circles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>

    <section class="container">
        <form id="form">
            <h2
                style="display: block; color: #3e0d13;   text-shadow: 2px 2px 5px rgba(60, 39, 83, 0.5);             font-size: 54px; text-align: center; padding: 10px 0px 20px 0px; ">
                User Form</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" name="name" id="name">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" id="email">
                <p id="emailError" style="font-size: 18px; color: red; font-weight: bold; display: none;"></p>
            </div>
            <div class="form-group">
                <label for="college">College Name</label>
                <input type="text" name="col_name" id="col_name" class="form-control" placeholder="Start typing your college name...">
                <ul id="collegeList" style="list-style-type: none; padding: 0;"></ul>
            </div>
            <div class="form-group">
                <label>State</label>
                <select name="state" id="state">
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Ladakh">Ladakh</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Puducherry">Puducherry</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                </select>
            </div>
            <div class="form-group">
                <label>Department</label>
                <select name="dept" id="dept">
                    <option value="Computer Science">Computer Science</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Science">Science</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Molecular Medicine">Molecular Medicine</option>
                    <option value="AI and Informatics">AI and Informatics</option>
                </select>
            </div>
            <div class="form-group">
                <label>Course</label>
                <input type="text" id="course" name="course">
            </div>
            <div class="form-group">
                <label>Year</label>
                <select name="year" id="year"></select>
            </div>
            <p id="result" style="display: none; font-size: 20px;color: green;font-weight: bold;">Form submitted
                Successfully... Redirecting...
            </p>
            <p id="result2" style="display: none; font-size: 20px;color: red;font-weight: bold;">An error occurred
            </p>
            <p id="result3" style="display: none; font-size: 20px;color: red;font-weight: bold;">The email address you
                entered is already associated with an account. Please enter a different email to proceed
            </p>
            <div class="btn">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
        <!-- <div id="loader">
        <p>Checking info...Redirecting...</p> 
    </div> -->
   <!--auto completing colleges Name--> 

   <script>
    document.getElementById('col_name').addEventListener('input', async function () {
        const query = this.value;
        if (query.length > 2) {  // Start searching after 3 characters
            const response = await fetch(`/search_colleges?q=${query}`);
            const colleges = await response.json();
            
            // Display the suggestions
            const collegeList = document.getElementById('collegeList');
            collegeList.innerHTML = '';  // Clear previous results
            colleges.forEach(college => {
                const li = document.createElement('li');
                
                li.style.backgroundColor = 'white';
            li.style.cursor = 'pointer';
            li.style.padding = '10px 15px';   // Padding for spacing inside the item
            li.style.borderBottom = '1px solid #ddd';  // Light border for better separation
            li.style.margin = '0';  // No margins between list items
            li.style.listStyle = 'none';  // Remove default bullet points
            li.style.color = '#333';  // Text color
            li.style.fontFamily = 'Arial, sans-serif';  // Font style
            li.style.transition = 'background-color 0.2s ease';  // Smooth hover transition

            // Add hover effect
            li.addEventListener('mouseover', () => {
                li.style.backgroundColor = '#f0f0f0';  // Change background on hover
            });
            li.addEventListener('mouseout', () => {
                li.style.backgroundColor = 'white';  // Reset background when not hovering
            });

            // On click, fill the input and clear the list
            li.addEventListener('click', () => {
                document.getElementById('col_name').value = college.name;
                collegeList.innerHTML = '';  // Clear the dropdown after selection
            });



                li.textContent = college.name;
                li.addEventListener('click', () => {
                    document.getElementById('col_name').value = college.name;  // Select college
                    collegeList.innerHTML = '';  // Clear the list
                });
                collegeList.appendChild(li);
            });
        }
    });
</script>







        <script>
            const currentYear = new Date().getFullYear();
            const graduationYearSelect = document.getElementById('year');
            for (let year = currentYear; year <= currentYear + 10; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.text = year;
                graduationYearSelect.appendChild(option);
            }

            // Real-time email validation and error display
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('emailError');

            emailInput.addEventListener('input', function () {
                const emailValue = emailInput.value;
                const allowedDomains = ['gmail.com', 'yahoo.com', 'outlook.com', 'icloud.com', 'hotmail.com'];

                if (emailValue) {
                    const emailDomain = emailValue.split('@')[1]; // Get the domain part of the email
                    if (!allowedDomains.includes(emailDomain)) {
                        emailError.textContent = "Please use an email from trusted providers (Gmail, Yahoo, Outlook, etc.)";
                        emailError.style.display = 'block';
                    } else {
                        emailError.style.display = 'none'; // Hide error if domain is valid
                    }
                } else {
                    emailError.style.display = 'none'; // Hide error if input is empty
                }
            });

            document.getElementById('form').addEventListener('submit', async function (event) {
                event.preventDefault();
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const col_name = document.getElementById('col_name').value;
                const state = document.getElementById('state').value;
                const dept = document.getElementById('dept').value;
                const course = document.getElementById('course').value.toUpperCase();
                const year = document.getElementById('year').value;

                const result = document.getElementById('result');
                const result2 = document.getElementById('result2');
                const result3 = document.getElementById('result3');

                // Validate email domain again before submission
                const allowedDomains = ['gmail.com', 'yahoo.com', 'outlook.com', 'icloud.com', 'hotmail.com'];
                const emailDomain = email.split('@')[1]; // Get the domain part of the email
                if (!allowedDomains.includes(emailDomain)) {
                    result2.innerText = "Please use an email from trusted providers (Gmail, Yahoo, Outlook, etc.)";
                    result2.style.display = "block";
                    setTimeout(() => {
                        result2.style.display = "none";
                    }, 3000);
                    return; // Stop form submission
                }

                const data = { name, email, col_name, state, course, year, dept };
                const token = localStorage.getItem('accessToken');
                const headers = new Headers();
                headers.append('Authorization', `Bearer ${token}`);

                try {
                    const response = await fetch('/info', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`,
                        },
                        body: JSON.stringify(data),
                    });
                  
                    console.log(response.status);

                    if (response.status == 200) {
                        console.log("Information saved");
                        result.style.display = "inline-block";
                        setTimeout(() => {
                            window.location.replace("main_page.html")
                        }, 2000);
                    }
                    else if (response.status == 400) {
                        result3.style.display = "inline-block";
                    }
                    else {
                        console.log("Submission failed");
                        result2.style.display = "block";
                        setTimeout(() => {
                            result2.style.display = "none";
                        }, 2000);
                    }
                } catch (error) {
                    console.error("Error occurred", error);
                }
            });

            async function usercheck() {
                const token = localStorage.getItem('accessToken');
                const headers = new Headers();
                headers.append('Authorization', `Bearer ${token}`);
                const response = await fetch('/form_filling', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                });
                if (response.status == 201) {
                    window.location.href = 'main_page.html'
                }
            }
            usercheck();
        </script>
    </section>
</body>

</html>
